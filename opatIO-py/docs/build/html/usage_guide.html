<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="C++ Utilities Usage Guide" href="cpp.html" /><link rel="prev" title="Installation" href="installation.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.08.06 -->
        <title>Usage Guide - opatio documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">opatio  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">opatio  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">C++ Utilities Usage Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="modules.html">opatio</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of opatio</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="opatio.html">opatio package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of opatio package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.base.html">opatio.base package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of opatio.base package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.base.header.html">opatio.base.header module</a></li>
<li class="toctree-l4"><a class="reference internal" href="opatio.base.opat.html">opatio.base.opat module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.card.html">opatio.card package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of opatio.card package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.card.datacard.html">opatio.card.datacard module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.catalog.html">opatio.catalog package</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of opatio.catalog package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.catalog.entry.html">opatio.catalog.entry module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.convert.html">opatio.convert package</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of opatio.convert package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.convert.opal.html">opatio.convert.opal module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.index.html">opatio.index package</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of opatio.index package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.index.floatvectorindex.html">opatio.index.floatvectorindex module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.lattice.html">opatio.lattice package</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of opatio.lattice package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.lattice.tableLattice.html">opatio.lattice.tableLattice module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.load.html">opatio.load package</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of opatio.load package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.load.load.html">opatio.load.load module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="opatio.misc.html">opatio.misc package</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of opatio.misc package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="opatio.misc.misc.html">opatio.misc.misc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="opatio.misc.opatentity.html">opatio.misc.opatentity module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/usage_guide.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="usage-guide">
<span id="usage"></span><h1>Usage Guide<a class="headerlink" href="#usage-guide" title="Link to this heading">¶</a></h1>
<p>This guide explains how to use the <code class="docutils literal notranslate"><span class="pre">opatio</span></code> library to work with OPAT (Open Parameterized Array Table) files.</p>
<section id="core-concepts">
<h2>Core Concepts<a class="headerlink" href="#core-concepts" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><strong>OPAT Object:</strong> The main object (<code class="docutils literal notranslate"><span class="pre">opatio.OPAT</span></code>) represents an entire OPAT file in memory. It holds the header, a catalog of data cards, and the data cards themselves.</p></li>
<li><p><strong>Index Vector:</strong> A tuple of floating-point numbers that parameterizes a specific data set (e.g., <code class="docutils literal notranslate"><span class="pre">(temperature,</span> <span class="pre">density)</span></code>). The number of elements in this tuple must match the <code class="docutils literal notranslate"><span class="pre">numIndex</span></code> value set in the OPAT header.</p></li>
<li><p><strong>Data Card:</strong> A container within the OPAT file associated with a specific Index Vector. It holds one or more tables relevant to that specific parameter combination.</p></li>
<li><p><strong>Table:</strong> A 2D or 3D array of data within a Data Card, identified by a string <code class="docutils literal notranslate"><span class="pre">tag</span></code>. Each table has associated row and column axis values (e.g., <code class="docutils literal notranslate"><span class="pre">logR</span></code>, <code class="docutils literal notranslate"><span class="pre">logT</span></code>).</p></li>
</ul>
</section>
<section id="creating-a-new-opat-file">
<h2>Creating a New OPAT File<a class="headerlink" href="#creating-a-new-opat-file" title="Link to this heading">¶</a></h2>
<p>Follow these steps to create an OPAT file from scratch:</p>
<ol class="arabic">
<li><p><strong>Import necessary libraries:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">opatio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</li>
<li><p><strong>Create an OPAT instance:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opat</span> <span class="o">=</span> <span class="n">opatio</span><span class="o">.</span><span class="n">OPAT</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><strong>Set Header Information (Optional but Recommended):</strong>
Define metadata for your file. Crucially, set the number of dimensions for your index vectors using <code class="docutils literal notranslate"><span class="pre">set_numIndex</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opat</span><span class="o">.</span><span class="n">set_comment</span><span class="p">(</span><span class="s2">&quot;Opacity data for stellar modeling&quot;</span><span class="p">)</span>
<span class="n">opat</span><span class="o">.</span><span class="n">set_source</span><span class="p">(</span><span class="s2">&quot;Generated from Model X calculations&quot;</span><span class="p">)</span>
<span class="n">opat</span><span class="o">.</span><span class="n">set_numIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Expecting 2D index vectors, e.g., (logT, logRho)</span>
</pre></div>
</div>
</li>
<li><p><strong>Prepare Your Data:</strong>
Define the index vector, table tag, axis values, and the main data array for each table you want to add.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example data for a specific (logT, logRho) combination</span>
<span class="n">index_vec_1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">)</span> <span class="c1"># Example: logT = 4.5, logRho = -3.0</span>
<span class="n">tag_1</span> <span class="o">=</span> <span class="s2">&quot;rosseland_mean&quot;</span>

<span class="c1"># Axis values for the table</span>
<span class="n">logR_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">8.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">])</span> <span class="c1"># Example: log(R) where R = rho / T_6^3</span>
<span class="n">logT_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">])</span>

<span class="c1"># The 2D data array (shape must match len(rowValues) x len(columnValues))</span>
<span class="n">opacity_data_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
<span class="p">])</span>
</pre></div>
</div>
</li>
<li><p><strong>Add the Table to the OPAT object:</strong>
Use the <code class="docutils literal notranslate"><span class="pre">add_table</span></code> method. This method handles creating or updating the appropriate <code class="docutils literal notranslate"><span class="pre">DataCard</span></code> associated with the <code class="docutils literal notranslate"><span class="pre">indexVector</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opat</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span>
    <span class="n">indexVector</span><span class="o">=</span><span class="n">index_vec_1</span><span class="p">,</span>
    <span class="n">tag</span><span class="o">=</span><span class="n">tag_1</span><span class="p">,</span>
    <span class="n">columnValues</span><span class="o">=</span><span class="n">logR_values</span><span class="p">,</span>     <span class="c1"># Data corresponding to columns</span>
    <span class="n">rowValues</span><span class="o">=</span><span class="n">logT_values</span><span class="p">,</span>        <span class="c1"># Data corresponding to rows</span>
    <span class="n">data</span><span class="o">=</span><span class="n">opacity_data_1</span><span class="p">,</span>
    <span class="n">columnName</span><span class="o">=</span><span class="s2">&quot;logR&quot;</span><span class="p">,</span>           <span class="c1"># Optional descriptive name for column axis</span>
    <span class="n">rowName</span><span class="o">=</span><span class="s2">&quot;logT&quot;</span>     <span class="c1"># Optional descriptive name for row axis</span>
<span class="p">)</span>

<span class="c1"># Add more tables for the same or different index vectors as needed</span>
<span class="c1"># index_vec_2 = (5.0, -2.5)</span>
<span class="c1"># opat.add_table(indexVector=index_vec_2, tag=&quot;planck_mean&quot;, ...)</span>
</pre></div>
</div>
</li>
<li><p><strong>Save the OPAT file:</strong>
Write the in-memory OPAT object to a binary file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">output_filename</span> <span class="o">=</span> <span class="s2">&quot;stellar_opacities.opat&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">opat</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OPAT file saved to </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also save a human-readable (but non-standard) ASCII representation for debugging:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opat</span><span class="o">.</span><span class="n">save_as_ascii</span><span class="p">(</span><span class="s2">&quot;stellar_opacities_debug.dat&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="loading-an-existing-opat-file">
<h2>Loading an Existing OPAT File<a class="headerlink" href="#loading-an-existing-opat-file" title="Link to this heading">¶</a></h2>
<p>To read data from an OPAT file:</p>
<ol class="arabic">
<li><p><strong>Import the library:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">opatio</span>
</pre></div>
</div>
</li>
<li><p><strong>Use `read_opat`:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">input_filename</span> <span class="o">=</span> <span class="s2">&quot;stellar_opacities.opat&quot;</span>
<span class="n">loaded_opat</span> <span class="o">=</span> <span class="n">opatio</span><span class="o">.</span><span class="n">read_opat</span><span class="p">(</span><span class="n">input_filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded </span><span class="si">{</span><span class="n">input_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Access Header Information:</strong>
Metadata is stored in the <code class="docutils literal notranslate"><span class="pre">header</span></code> attribute.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comment: </span><span class="si">{</span><span class="n">loaded_opat</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">comment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source: </span><span class="si">{</span><span class="n">loaded_opat</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">sourceInfo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Index Dimensions: </span><span class="si">{</span><span class="n">loaded_opat</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">numIndex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of Data Cards: </span><span class="si">{</span><span class="n">loaded_opat</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">numCards</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Access Data Cards and Tables:</strong>
Data cards are stored in the <code class="docutils literal notranslate"><span class="pre">cards</span></code> dictionary, keyed by <code class="docutils literal notranslate"><span class="pre">FloatVectorIndex</span></code> objects. Tables within a card are accessed like dictionary items using their string tag.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the index vector you want to retrieve data for</span>
<span class="n">target_index_vec</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">target_tag</span> <span class="o">=</span> <span class="s2">&quot;rosseland_mean&quot;</span>

<span class="n">target_card</span> <span class="o">=</span> <span class="n">loaded_opat</span><span class="p">[</span><span class="n">target_index_vec</span><span class="p">]</span>

<span class="n">target_table</span> <span class="o">=</span> <span class="n">target_card</span><span class="p">[</span><span class="n">target_tag</span><span class="p">]</span>

<span class="c1"># Access the table&#39;s components</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Table Tag: </span><span class="si">{</span><span class="n">target_tag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Column Axis (</span><span class="si">{</span><span class="n">target_card</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">target_tag</span><span class="p">]</span><span class="o">.</span><span class="n">columnName</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">target_table</span><span class="o">.</span><span class="n">columnValues</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row Axis (</span><span class="si">{</span><span class="n">target_card</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">target_tag</span><span class="p">]</span><span class="o">.</span><span class="n">rowName</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">target_table</span><span class="o">.</span><span class="n">rowValues</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data Array (shape </span><span class="si">{</span><span class="n">target_table</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">):</span><span class="se">\n</span><span class="si">{</span><span class="n">target_table</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="modifying-an-opat-file">
<h2>Modifying an OPAT File<a class="headerlink" href="#modifying-an-opat-file" title="Link to this heading">¶</a></h2>
<p>You can load an OPAT file, modify it (add/remove cards/tables), and save the changes.</p>
<ol class="arabic simple">
<li><p><strong>Load the file</strong> as shown above.</p></li>
<li><p><strong>Add a new table or card</strong> using <code class="docutils literal notranslate"><span class="pre">loaded_opat.add_table(...)</span></code> or <code class="docutils literal notranslate"><span class="pre">loaded_opat.add_card(...)</span></code>.</p></li>
<li><p><strong>Remove an existing card</strong> using <code class="docutils literal notranslate"><span class="pre">loaded_opat.pop_card(index_vector)</span></code>. Note this removes the entire card associated with that index vector.</p></li>
<li><p><strong>Re-save the file</strong> using <code class="docutils literal notranslate"><span class="pre">loaded_opat.save(input_filename)</span></code> (overwriting) or <code class="docutils literal notranslate"><span class="pre">loaded_opat.save(&quot;modified_opacities.opat&quot;)</span></code> (saving to a new file).</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Removing a card (assuming loaded_opat exists)</span>
<span class="n">index_to_remove_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">index_to_remove_key</span> <span class="o">=</span> <span class="n">FloatVectorIndex</span><span class="p">(</span>
    <span class="n">vector</span><span class="o">=</span><span class="n">index_to_remove_tuple</span><span class="p">,</span>
    <span class="n">hashPrecision</span><span class="o">=</span><span class="n">loaded_opat</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">hashPrecision</span>
<span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">removed_card</span> <span class="o">=</span> <span class="n">loaded_opat</span><span class="o">.</span><span class="n">pop_card</span><span class="p">(</span><span class="n">index_to_remove_key</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed card for index </span><span class="si">{</span><span class="n">index_to_remove_tuple</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Now save the modified opat object</span>
    <span class="c1"># loaded_opat.save(&quot;modified_file.opat&quot;)</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Card for index </span><span class="si">{</span><span class="n">index_to_remove_tuple</span><span class="si">}</span><span class="s2"> not found, nothing removed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="converting-opal-type-i-files">
<h2>Converting OPAL Type I Files<a class="headerlink" href="#converting-opal-type-i-files" title="Link to this heading">¶</a></h2>
<p>The library includes a utility to convert OPAL Type I opacity files to the OPAT format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">opatio.convert</span> <span class="kn">import</span> <span class="n">OPALI_2_OPAT</span>

<span class="n">opal_input_file</span> <span class="o">=</span> <span class="s2">&quot;path/to/your/opal_file.GN93&quot;</span>
<span class="n">opat_output_file</span> <span class="o">=</span> <span class="s2">&quot;converted_opal.opat&quot;</span>

<span class="n">OPALI_2_OPAT</span><span class="p">(</span><span class="n">opal_input_file</span><span class="p">,</span> <span class="n">opat_output_file</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converted </span><span class="si">{</span><span class="n">opal_input_file</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">opat_output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Optionally save an ASCII version for inspection</span>
<span class="n">OPALI_2_OPAT</span><span class="p">(</span><span class="n">opal_input_file</span><span class="p">,</span> <span class="n">opat_output_file</span><span class="p">,</span> <span class="n">saveAsASCII</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Also saved ASCII debug file.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This provides a basic overview. Refer to the API Reference section for detailed information on specific classes and methods.</p>
</section>
<section id="storing-3d-data">
<h2>Storing 3D Data<a class="headerlink" href="#storing-3d-data" title="Link to this heading">¶</a></h2>
<p>To store 3D data, you can use the <cite>add_table</cite> method with a 3D numpy array. The method will automatically handle the additional dimension.
For example, if you have a 2D array of temperature and density and for each point you want to store a vector of interpolation coefficients
you can do the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example data for a specific (logT, logR) combination</span>
<span class="n">tag_1</span> <span class="o">=</span> <span class="s2">&quot;rosseland_mean&quot;</span>
<span class="c1"># Axis values for the table</span>
<span class="n">logR_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">8.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">])</span> <span class="c1"># Example: log(R) where R = rho / T_6^3</span>
<span class="n">logT_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">])</span>

<span class="c1"># The 3D data array (shape must match len(rowValues) x len(columnValues) x num_coefficients)</span>
<span class="n">opacity_data_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># Random data for demonstration</span>

<span class="n">opat</span><span class="o">.</span><span class="n">add_table</span><span class="p">(</span>
    <span class="n">tag</span><span class="o">=</span><span class="n">tag_1</span><span class="p">,</span>
    <span class="n">columnValues</span><span class="o">=</span><span class="n">logR_values</span><span class="p">,</span>
    <span class="n">rowValues</span><span class="o">=</span><span class="n">logT_values</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">opacity_data_1</span><span class="p">,</span>
    <span class="n">columnName</span><span class="o">=</span><span class="s2">&quot;logR&quot;</span><span class="p">,</span>
    <span class="n">rowName</span><span class="o">=</span><span class="s2">&quot;logT&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The shape will automatically be inferred from the data you provide. The <cite>add_table</cite> method will handle the additional dimension and store it correctly in the OPAT file.</p>
</section>
<section id="using-tablelattice-for-interpolation">
<h2>Using TableLattice for Interpolation<a class="headerlink" href="#using-tablelattice-for-interpolation" title="Link to this heading">¶</a></h2>
<p>The <cite>TableLattice</cite> class provides a powerful mechanism for interpolating data stored in an OPAT object using Delaunay triangulation. This is particularly useful for estimating data for index vectors that are not explicitly present in the OPAT file.</p>
<section id="example-basic-interpolation">
<h3>Example: Basic Interpolation<a class="headerlink" href="#example-basic-interpolation" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p><strong>Import the necessary classes:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">opatio.base.opat</span> <span class="kn">import</span> <span class="n">OPAT</span>
<span class="kn">from</span> <span class="nn">opatio.lattice.tableLattice</span> <span class="kn">import</span> <span class="n">TableLattice</span>
<span class="kn">from</span> <span class="nn">opatio.index.floatvectorindex</span> <span class="kn">import</span> <span class="n">FloatVectorIndex</span>
</pre></div>
</div>
</li>
<li><p><strong>Load or create an OPAT object:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">opat</span> <span class="o">=</span> <span class="n">read_opat</span><span class="p">(</span><span class="s2">&quot;path/to/your/opat_file.opat&quot;</span><span class="p">)</span>
<span class="c1"># Add data to the OPAT object (see previous sections for details)</span>
</pre></div>
</div>
</li>
<li><p><strong>Create a `TableLattice` instance:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lattice</span> <span class="o">=</span> <span class="n">TableLattice</span><span class="p">(</span><span class="n">opat</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Query for interpolated data:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_vector</span> <span class="o">=</span> <span class="n">FloatVectorIndex</span><span class="p">((</span><span class="mf">4.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.25</span><span class="p">))</span>  <span class="c1"># Example query vector</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">interpolated_card</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_vector</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Interpolation successful!&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Access the interpolated table:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;rosseland_mean&quot;</span>
<span class="n">interpolated_table</span> <span class="o">=</span> <span class="n">interpolated_card</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolated data for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">interpolated_table</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="advanced-example-interpolating-multiple-tables">
<h3>Advanced Example: Interpolating Multiple Tables<a class="headerlink" href="#advanced-example-interpolating-multiple-tables" title="Link to this heading">¶</a></h3>
<p>You can interpolate multiple tables simultaneously if the data cards have consistent tags.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_vector</span> <span class="o">=</span> <span class="n">FloatVectorIndex</span><span class="p">((</span><span class="mf">4.75</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.25</span><span class="p">))</span>
<span class="n">interpolated_card</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_vector</span><span class="p">)</span>

<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">interpolated_card</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">interpolated_table</span> <span class="o">=</span> <span class="n">interpolated_card</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolated data for tag &#39;</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">interpolated_table</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="potential-pitfalls-and-gotchas">
<h3>Potential Pitfalls and Gotchas<a class="headerlink" href="#potential-pitfalls-and-gotchas" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p><strong>Query Point Outside Triangulation:</strong>
If the query vector lies outside the convex hull of the index vectors, interpolation will fail with a <cite>ValueError</cite>. Ensure that your query vector is within the range of the data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_vector</span> <span class="o">=</span> <span class="n">FloatVectorIndex</span><span class="p">((</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">))</span>  <span class="c1"># Outside the convex hull</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">interpolated_card</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_vector</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Query point is outside the triangulation.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Inconsistent Tags Across Data Cards:</strong>
The interpolation assumes that all data cards in the OPAT object have the same set of tags. If tags differ between cards, interpolation will fail. Verify consistency before using <cite>TableLattice</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check tags consistency</span>
<span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">opat</span><span class="o">.</span><span class="n">cards</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tags are inconsistent across data cards.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Collinear Points:</strong>
If the index vectors are collinear, Delaunay triangulation cannot be constructed. Ensure that your index vectors span a valid space.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">TableLattice</span><span class="p">(</span><span class="n">opat</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to build triangulation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p><strong>Precision Issues:</strong>
Floating-point precision can affect the triangulation and interpolation. Use consistent precision for index vectors and query vectors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query_vector</span> <span class="o">=</span> <span class="n">FloatVectorIndex</span><span class="p">((</span><span class="mf">4.7500001</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2500001</span><span class="p">))</span>  <span class="c1"># Slightly off due to precision</span>
<span class="n">interpolated_card</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_vector</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading">¶</a></h3>
<p>The <cite>TableLattice</cite> class is a robust tool for interpolating data stored in OPAT files. By understanding its functionality and addressing potential pitfalls, you can effectively use it to estimate data for arbitrary index vectors.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cpp.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">C++ Utilities Usage Guide</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="installation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, 4D-STAR collaboration, Emily M. Boudreaux, Aaron Dotter
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Usage Guide</a><ul>
<li><a class="reference internal" href="#core-concepts">Core Concepts</a></li>
<li><a class="reference internal" href="#creating-a-new-opat-file">Creating a New OPAT File</a></li>
<li><a class="reference internal" href="#loading-an-existing-opat-file">Loading an Existing OPAT File</a></li>
<li><a class="reference internal" href="#modifying-an-opat-file">Modifying an OPAT File</a></li>
<li><a class="reference internal" href="#converting-opal-type-i-files">Converting OPAL Type I Files</a></li>
<li><a class="reference internal" href="#storing-3d-data">Storing 3D Data</a></li>
<li><a class="reference internal" href="#using-tablelattice-for-interpolation">Using TableLattice for Interpolation</a><ul>
<li><a class="reference internal" href="#example-basic-interpolation">Example: Basic Interpolation</a></li>
<li><a class="reference internal" href="#advanced-example-interpolating-multiple-tables">Advanced Example: Interpolating Multiple Tables</a></li>
<li><a class="reference internal" href="#potential-pitfalls-and-gotchas">Potential Pitfalls and Gotchas</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>